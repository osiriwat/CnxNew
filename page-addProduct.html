<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>CnxCenterpoint</title>
    <script src="js/angular.min.js"></script>
    <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/jquery.mobile-1.4.5.min.js"></script>
    <script src="config.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" charset="utf-8">
        var pictureSource; // picture source
        var destinationType; // sets the format of returned value

        // Wait for device API libraries to load
        //
        document.addEventListener("deviceready", onDeviceReady, false);

        // device APIs are available
        //
        function onDeviceReady() {
            pictureSource = navigator.camera.PictureSourceType;
            destinationType = navigator.camera.DestinationType;
        }

        // Called when a photo is successfully retrieved
        //
        function onPhotoDataSuccess(imageData) {
            var smallImage = document.getElementById('smallImage');
            smallImage.style.display = 'block';
            smallImage.src = "data:image/jpeg;base64," + imageData;
        }

        function onPhotoURISuccess(imageURI) {
            var largeImage = document.getElementById('largeImage');
            largeImage.style.display = 'block';
            largeImage.src = imageURI;
        }

        function capturePhoto() {
            // Take picture using device camera and retrieve image as base64-encoded string
            navigator.camera.getPicture(onPhotoDataSuccess, onFail, {
                quality: 50,
                destinationType: destinationType.DATA_URL
            });
        }

        function capturePhotoEdit() {
            // Take picture using device camera, allow edit, and retrieve image as base64-encoded string
            navigator.camera.getPicture(onPhotoDataSuccess, onFail, {
                quality: 20,
                allowEdit: true,
                destinationType: destinationType.DATA_URL
            });
        }

        function getPhoto(source) {
            // Retrieve image file location from specified source
            navigator.camera.getPicture(onPhotoURISuccess, onFail, {
                quality: 50,
                destinationType: destinationType.FILE_URI,
                sourceType: source
            });
        }

        function onFail(message) {
            alert('Failed because: ' + message);
        }
    </script>
</head>

<body>

    <div data-role="page" ng-app="myApp" ng-controller="myCtrl">
        <div data-role="header">
            <a href="#" ng-click="back()" style="margin-top: 5px" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-carat-l">Back</a>
            <p style="text-align:center;">เพิ่มสินค้า</p>
            <a href="#" style="margin-top: 5px" ng-click="Save()" class="ui-btn-right ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-right ui-icon-check">บันทึก</a>
        </div>

        <div data-role="content">
            <div class="ui-grid-a">

                <div wight=100%>
                    <div class="ui-block-a-30%" style="text-align:left;"><a class="ui-corner-all"></a>
                        <!-- /กดเพื่อเข้าไปเพิ่มรูปสินค้าจากอัลบั้มรูป (ต้องขออนุญาตการเข้าถึงจากตัวอุปกรณ์)-->
                        <a href="#"><img src=" " width="100px" height="100px" border="3" border-color="#000000"></a><br>
                        <button onclick="capturePhoto();">Capture Photo</button> <br>
                        <button onclick="capturePhotoEdit();">Capture Editable Photo</button> <br>
                        <button onclick="getPhoto(pictureSource.PHOTOLIBRARY);">From Photo Library</button><br>
                        <button onclick="getPhoto(pictureSource.SAVEDPHOTOALBUM);">From Photo Album</button><br>
                        <img style="display:none;width:60px;height:60px;" id="smallImage" src="" />
                        <img style="display:none;" id="largeImage" src="" />
                    </div>

                    <form>
                        <div class="ui-field-contain">
                            <label for="text-12">ชื่อสินค้า:</label>
                            <input type="text" name="text-12" ng-model="product.Product_name" id="text-12" value="">
                        </div>
                        <div class="ui-field-contain">
                            <label for="text-13">คำอธิบาย:</label>
                            <input type="text" data-clear-btn="true" ng-model="product.Product_explanation" name="text-13"
                                id="text-13" value="">
                        </div>
                        <div class="ui-field-contain">
                            <div class="ui-field-contain">
                                <label for="text-12">ขนาด:</label>
                                <input type="number" name="text-12" ng-model="product.Product_size" id="text-12" value="">
                            </div>

                            <div class="ui-field-contain">
                                <label for="text-12">น้ำหนัก:</label>
                                <input type="number" name="text-12" ng-model="product.Product_weight" id="text-12"
                                    value="">
                            </div>

                            <div class="ui-field-contain">
                                <label for="text-12">วิธีใช้:</label>
                                <input type="text" name="text-12" ng-model="product.Product_instruction" id="text-12"
                                    value="">
                            </div>

                            <div class="ui-field-contain">
                                <label for="text-12">อื่นๆ:</label>
                                <input type="text" name="text-12" ng-model="product.Product_other" id="text-12" value="">
                            </div>

                            <div class="ui-field-contain">
                                <label for="text-12">ราคา:</label>
                                <input type="number" name="text-12" ng-model="product.Product_price" id="text-12" value="">
                            </div>

                            <ui>
                                <div class="ui-field-contain">
                                    <label for="text-13">หมวดสินค้า:</label>
                                    <select name="select-choice-a" id="select-choice-a" data-native-menu="true"
                                        ng-options="x.Product_group for x in productgroups" ng-model="product.Product_group"></select>
                                </div>
                                <ui>
                                    <div class="ui-field-contain">
                                        <label for="text-13">ประเภทสินค้า:</label>
                                        <select name="select-choice-a" id="select-choice-a" data-native-menu="true"
                                            ng-options="x.Product_type for x in producttypes" ng-model="product.Product_type"></select>
                                    </div>
                                    <div class="ui-field-contain">
                                        <label for="text-13">หน่วยนับ:</label>
                                        <select name="select-choice-a" id="select-choice-a" data-native-menu="true"
                                            ng-options="x.Product_unit for x in productunits" ng-model="product.Product_unit"></select>
                                    </div>
                                    <div class="ui-field-contain">
                                        <label for="text-12">Keywords:</label>
                                        <input type="text" name="text-12" ng-model="product.Keyword" id="text-12" value="">
                                    </div>
                                    <div class="ui-field-contain">
                                        <label for="text-12">Title:</label>
                                        <input type="text" name="text-12" ng-model="product.Title" id="text-12" value="">
                                    </div>

                                    <div class="ui-field-contain">
                                        <label for="text-12">Description:</label>
                                        <input type="text" name="text-12" ng-model="product.Description" id="text-12"
                                            value="">
                                    </div>


                                    <div class="ui-field-contain">
                                        <label for="text-12">Website:</label>
                                        <input type="text" name="text-12" ng-model="product.Website" id="text-12" value="">
                                    </div>


                        </div>
                    </form>

                </div>




            </div><!-- /navbar -->



            <div data-role="footer" data-position="fixed">
                <div data-role="navbar">
                    <ul>
                        <li><a href="index.html" data-icon="home" data-ajax="false">หน้าแรก</a></li>
                        <li><a href="https://thai.cnxcenterpoint.com/" data-icon="eye" data-ajax="false">ชมเว็บไชต์</a></li>
                        <li><a href="page-help.html" data-icon="info" data-ajax="false">ช่วยเหลือ</a></li>
                        <li><a href="#" data-icon="user" data-ajax="false" class="ui-btn-active">บัญชีของฉัน</a></li>
                    </ul>
                </div>
            </div><!-- /footer -->
        </div><!-- /page popup -->
        <script>
            var app = angular.module('myApp', []);
            app.controller('myCtrl', function ($scope, $http, $window) {
                $(document).ready(function () {
                    var getProductGroups = $http({
                        method: "GET",
                        url: ip_address + 'Products/GetAllGroup',
                        dataType: 'json',
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then(function successCallback(response) {
                        if (response.data != "null") {
                            $scope.productgroups = response.data.results;
                        }
                    }, function errorCallback(response) {
                        alert("Error");
                    });

                    var getProductUnit = $http({
                        method: "GET",
                        url: ip_address + 'Products/GetAllUnit',
                        dataType: 'json',
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then(function successCallback(response) {
                        if (response.data != "null") {
                            $scope.productunits = response.data.results;
                        }
                    }, function errorCallback(response) {
                        alert("Error");
                    });

                    var getProductType = $http({
                        method: "GET",
                        url: ip_address + 'Products/GetAllType',
                        dataType: 'json',
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then(function successCallback(response) {
                        if (response.data != "null") {
                            $scope.producttypes = response.data.results;
                        }
                    }, function errorCallback(response) {
                        alert("Error");
                    });
                });

                $scope.back = function () {
                    window.location.href = "page-User.html";
                }
                $scope.Save = function () {
                    $scope.product.User_Id = $window.sessionStorage.getItem("userId");
                    if ($scope.product.Product_group)
                        $scope.product.Product_group_id = $scope.product.Product_group.Id;

                    if ($scope.product.Product_type)
                        $scope.product.Product_type_id = $scope.product.Product_type.Id;

                    if ($scope.product.Product_type)
                        $scope.product.Product_unit_id = $scope.product.Product_unit.Id;


                    $.ajax({
                        type: 'POST',
                        url: ip_address + "Products/Create",
                        data: {
                            tbproduct: $scope.product
                        },
                        cache: false,
                        success: function (result) {
                            if (result.exception) {
                                alert(result.exception.Message);
                            } else {
                                alert("Save Success");
                                window.location.href = "page-User.html";
                            }
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("Error");
                        }
                    });
                }
            });
        </script>
</body>

</html>